"use client";import{useFocusRing as Ee}from"@react-aria/focus";import{useHover as Se}from"@react-aria/interactions";import{useVirtualizer as ke}from"@tanstack/react-virtual";import D,{Fragment as Ie,createContext as me,createRef as He,useCallback as ce,useContext as fe,useMemo as K,useReducer as Ue,useRef as Z,useState as Pe}from"react";import{flushSync as ee}from"react-dom";import{useActivePress as Ge}from'../../hooks/use-active-press.js';import{useByComparator as ze}from'../../hooks/use-by-comparator.js';import{useControllable as Ke}from'../../hooks/use-controllable.js';import{useDefaultValue as We}from'../../hooks/use-default-value.js';import{useDisposables as je}from'../../hooks/use-disposables.js';import{useElementSize as Ae}from'../../hooks/use-element-size.js';import{useEvent as c}from'../../hooks/use-event.js';import{useId as se}from'../../hooks/use-id.js';import{useInertOthers as $e}from'../../hooks/use-inert-others.js';import{useIsoMorphicEffect as J}from'../../hooks/use-iso-morphic-effect.js';import{useLatestValue as Xe}from'../../hooks/use-latest-value.js';import{useOnDisappear as Je}from'../../hooks/use-on-disappear.js';import{useOutsideClick as qe}from'../../hooks/use-outside-click.js';import{useOwnerDocument as Re}from'../../hooks/use-owner.js';import{useRefocusableInput as _e}from'../../hooks/use-refocusable-input.js';import{useResolveButtonType as Ye}from'../../hooks/use-resolve-button-type.js';import{useScrollLock as Qe}from'../../hooks/use-scroll-lock.js';import{useSyncRefs as de}from'../../hooks/use-sync-refs.js';import{useTrackedPointer as Ze}from'../../hooks/use-tracked-pointer.js';import{transitionDataAttributes as et,useTransition as tt}from'../../hooks/use-transition.js';import{useTreeWalker as ot}from'../../hooks/use-tree-walker.js';import{useWatch as he}from'../../hooks/use-watch.js';import{useDisabled as nt}from'../../internal/disabled.js';import{FloatingProvider as it,useFloatingPanel as rt,useFloatingPanelProps as lt,useFloatingReference as at,useResolvedAnchor as ut}from'../../internal/floating.js';import{FormFields as pt}from'../../internal/form-fields.js';import{Frozen as st,useFrozenData as Me}from'../../internal/frozen.js';import{useProvidedId as dt}from'../../internal/id.js';import{OpenClosedProvider as bt,State as be,useOpenClosed as mt}from'../../internal/open-closed.js';import{history as De}from'../../utils/active-element-history.js';import{isDisabledReactIssue7711 as ct}from'../../utils/bugs.js';import{Focus as P,calculateActiveIndex as Fe}from'../../utils/calculate-active-index.js';import{disposables as Ve}from'../../utils/disposables.js';import{sortByDomNode as ft}from'../../utils/focus-management.js';import{match as te}from'../../utils/match.js';import{isMobile as Tt}from'../../utils/platform.js';import{RenderFeatures as Le,forwardRefWithAs as ie,mergeProps as Te,render as re}from'../../utils/render.js';import{useDescribedBy as xt}from'../description/description.js';import{Keys as L}from'../keyboard.js';import{Label as gt,useLabelledBy as xe,useLabels as vt}from'../label/label.js';import{MouseButton as Be}from'../mouse.js';import{Portal as yt}from'../portal/portal.js';var Ot=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ot||{}),Ct=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(Ct||{}),Et=(o=>(o[o.Pointer=0]="Pointer",o[o.Focus=1]="Focus",o[o.Other=2]="Other",o))(Et||{}),St=(l=>(l[l.OpenCombobox=0]="OpenCombobox",l[l.CloseCombobox=1]="CloseCombobox",l[l.GoToOption=2]="GoToOption",l[l.SetTyping=3]="SetTyping",l[l.RegisterOption=4]="RegisterOption",l[l.UnregisterOption=5]="UnregisterOption",l[l.SetActivationTrigger=6]="SetActivationTrigger",l[l.UpdateVirtualConfiguration=7]="UpdateVirtualConfiguration",l[l.SetInputElement=8]="SetInputElement",l[l.SetButtonElement=9]="SetButtonElement",l[l.SetOptionsElement=10]="SetOptionsElement",l))(St||{});function ge(t,n=e=>e){let e=t.activeOptionIndex!==null?t.options[t.activeOptionIndex]:null,o=n(t.options.slice()),f=o.length>0&&o[0].dataRef.current.order!==null?o.sort((m,d)=>m.dataRef.current.order-d.dataRef.current.order):ft(o,m=>m.dataRef.current.domRef.current),b=e?f.indexOf(e):null;return b===-1&&(b=null),{options:f,activeOptionIndex:b}}let It={[1](t){var n;return(n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===1?t:{...t,activeOptionIndex:null,comboboxState:1,isTyping:!1,activationTrigger:2,__demoMode:!1}},[0](t){var n,e;if((n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===0)return t;if((e=t.dataRef.current)!=null&&e.value){let o=t.dataRef.current.calculateIndex(t.dataRef.current.value);if(o!==-1)return{...t,activeOptionIndex:o,comboboxState:0,__demoMode:!1}}return{...t,comboboxState:0,__demoMode:!1}},[3](t,n){return t.isTyping===n.isTyping?t:{...t,isTyping:n.isTyping}},[2](t,n){var b,m,d,T;if((b=t.dataRef.current)!=null&&b.disabled||t.optionsElement&&!((m=t.dataRef.current)!=null&&m.optionsPropsRef.current.static)&&t.comboboxState===1)return t;if(t.virtual){let{options:r,disabled:i}=t.virtual,l=n.focus===P.Specific?n.idx:Fe(n,{resolveItems:()=>r,resolveActiveIndex:()=>{var R,p;return(p=(R=t.activeOptionIndex)!=null?R:r.findIndex(F=>!i(F)))!=null?p:null},resolveDisabled:i,resolveId(){throw new Error("Function not implemented.")}}),E=(d=n.trigger)!=null?d:2;return t.activeOptionIndex===l&&t.activationTrigger===E?t:{...t,activeOptionIndex:l,activationTrigger:E,isTyping:!1,__demoMode:!1}}let e=ge(t);if(e.activeOptionIndex===null){let r=e.options.findIndex(i=>!i.dataRef.current.disabled);r!==-1&&(e.activeOptionIndex=r)}let o=n.focus===P.Specific?n.idx:Fe(n,{resolveItems:()=>e.options,resolveActiveIndex:()=>e.activeOptionIndex,resolveId:r=>r.id,resolveDisabled:r=>r.dataRef.current.disabled}),f=(T=n.trigger)!=null?T:2;return t.activeOptionIndex===o&&t.activationTrigger===f?t:{...t,...e,isTyping:!1,activeOptionIndex:o,activationTrigger:f,__demoMode:!1}},[4]:(t,n)=>{var b,m,d;if((b=t.dataRef.current)!=null&&b.virtual)return{...t,options:[...t.options,n.payload]};let e=n.payload,o=ge(t,T=>(T.push(e),T));t.activeOptionIndex===null&&(m=t.dataRef.current)!=null&&m.isSelected(n.payload.dataRef.current.value)&&(o.activeOptionIndex=o.options.indexOf(e));let f={...t,...o,activationTrigger:2};return(d=t.dataRef.current)!=null&&d.__demoMode&&t.dataRef.current.value===void 0&&(f.activeOptionIndex=0),f},[5]:(t,n)=>{var o;if((o=t.dataRef.current)!=null&&o.virtual)return{...t,options:t.options.filter(f=>f.id!==n.id)};let e=ge(t,f=>{let b=f.findIndex(m=>m.id===n.id);return b!==-1&&f.splice(b,1),f});return{...t,...e,activationTrigger:2}},[6]:(t,n)=>t.activationTrigger===n.trigger?t:{...t,activationTrigger:n.trigger},[7]:(t,n)=>{var o,f;if(t.virtual===null)return{...t,virtual:{options:n.options,disabled:(o=n.disabled)!=null?o:()=>!1}};if(t.virtual.options===n.options&&t.virtual.disabled===n.disabled)return t;let e=t.activeOptionIndex;if(t.activeOptionIndex!==null){let b=n.options.indexOf(t.virtual.options[t.activeOptionIndex]);b!==-1?e=b:e=null}return{...t,activeOptionIndex:e,virtual:{options:n.options,disabled:(f=n.disabled)!=null?f:()=>!1}}},[8]:(t,n)=>t.inputElement===n.element?t:{...t,inputElement:n.element},[9]:(t,n)=>t.buttonElement===n.element?t:{...t,buttonElement:n.element},[10]:(t,n)=>t.optionsElement===n.element?t:{...t,optionsElement:n.element}},ve=me(null);ve.displayName="ComboboxActionsContext";function le(t){let n=fe(ve);if(n===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,le),e}return n}let we=me(null);function Pt(t){let n=oe("VirtualProvider"),{options:e}=n.virtual,[o,f]=K(()=>{let r=n.optionsElement;if(!r)return[0,0];let i=window.getComputedStyle(r);return[parseFloat(i.paddingBlockStart||i.paddingTop),parseFloat(i.paddingBlockEnd||i.paddingBottom)]},[n.optionsElement]),b=ke({enabled:e.length!==0,scrollPaddingStart:o,scrollPaddingEnd:f,count:e.length,estimateSize(){return 40},getScrollElement(){return n.optionsElement},overscan:12}),[m,d]=Pe(0);J(()=>{d(r=>r+1)},[e]);let T=b.getVirtualItems();return T.length===0?null:D.createElement(we.Provider,{value:b},D.createElement("div",{style:{position:"relative",width:"100%",height:`${b.getTotalSize()}px`},ref:r=>{if(r){if(typeof process!="undefined"&&process.env.JEST_WORKER_ID!==void 0||n.activationTrigger===0)return;n.activeOptionIndex!==null&&e.length>n.activeOptionIndex&&b.scrollToIndex(n.activeOptionIndex)}}},T.map(r=>{var i;return D.createElement(Ie,{key:r.key},D.cloneElement((i=t.children)==null?void 0:i.call(t,{...t.slot,option:e[r.index]}),{key:`${m}-${r.key}`,"data-index":r.index,"aria-setsize":e.length,"aria-posinset":r.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${r.start}px)`,overflowAnchor:"none"}}))})))}let ae=me(null);ae.displayName="ComboboxDataContext";function oe(t){let n=fe(ae);if(n===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,oe),e}return n}function At(t,n){return te(n.type,It,t,n)}let Rt=Ie;function _t(t,n){var ye,Oe;let e=nt(),{value:o,defaultValue:f,onChange:b,form:m,name:d,by:T,disabled:r=e||!1,onClose:i,__demoMode:l=!1,multiple:E=!1,immediate:R=!1,virtual:p=null,nullable:F,...N}=t,h=We(f),[S=E?[]:void 0,O]=Ke(o,b,h),[I,x]=Ue(At,{dataRef:He(),comboboxState:l?0:1,isTyping:!1,options:[],virtual:p?{options:p.options,disabled:(ye=p.disabled)!=null?ye:()=>!1}:null,activeOptionIndex:null,activationTrigger:2,inputElement:null,buttonElement:null,optionsElement:null,__demoMode:l}),M=Z(!1),y=Z({static:!1,hold:!1}),B=ze(T),W=c(u=>p?T===null?p.options.indexOf(u):p.options.findIndex(v=>B(v,u)):I.options.findIndex(v=>B(v.dataRef.current.value,u))),j=ce(u=>te(s.mode,{[1]:()=>S.some(v=>B(v,u)),[0]:()=>B(S,u)}),[S]),U=c(u=>I.activeOptionIndex===W(u)),s=K(()=>({...I,immediate:R,optionsPropsRef:y,value:S,defaultValue:h,disabled:r,mode:E?1:0,virtual:p?I.virtual:null,get activeOptionIndex(){if(M.current&&I.activeOptionIndex===null&&(p?p.options.length>0:I.options.length>0)){if(p){let v=p.options.findIndex(z=>{var pe,Ce;return!((Ce=(pe=p.disabled)==null?void 0:pe.call(p,z))!=null&&Ce)});if(v!==-1)return v}let u=I.options.findIndex(v=>!v.dataRef.current.disabled);if(u!==-1)return u}return I.activeOptionIndex},calculateIndex:W,compare:B,isSelected:j,isActive:U}),[S,h,r,E,l,I,p]);J(()=>{var u;p&&x({type:7,options:p.options,disabled:(u=p.disabled)!=null?u:null})},[p,p==null?void 0:p.options,p==null?void 0:p.disabled]),J(()=>{I.dataRef.current=s},[s]);let $=s.comboboxState===0;qe($,[s.buttonElement,s.inputElement,s.optionsElement],()=>V.closeCombobox());let k=K(()=>{var u,v,z;return{open:s.comboboxState===0,disabled:r,activeIndex:s.activeOptionIndex,activeOption:s.activeOptionIndex===null?null:s.virtual?s.virtual.options[(u=s.activeOptionIndex)!=null?u:0]:(z=(v=s.options[s.activeOptionIndex])==null?void 0:v.dataRef.current.value)!=null?z:null,value:S}},[s,r,S]),g=c(()=>{if(s.activeOptionIndex!==null){if(V.setIsTyping(!1),s.virtual)A(s.virtual.options[s.activeOptionIndex]);else{let{dataRef:u}=s.options[s.activeOptionIndex];A(u.current.value)}V.goToOption(P.Specific,s.activeOptionIndex)}}),G=c(()=>{x({type:0}),M.current=!0}),ne=c(()=>{x({type:1}),M.current=!1,i==null||i()}),q=c(u=>{x({type:3,isTyping:u})}),Y=c((u,v,z)=>(M.current=!1,u===P.Specific?x({type:2,focus:P.Specific,idx:v,trigger:z}):x({type:2,focus:u,trigger:z}))),Q=c((u,v)=>(x({type:4,payload:{id:u,dataRef:v}}),()=>{s.isActive(v.current.value)&&(M.current=!0),x({type:5,id:u})})),A=c(u=>te(s.mode,{[0](){return O==null?void 0:O(u)},[1](){let v=s.value.slice(),z=v.findIndex(pe=>B(pe,u));return z===-1?v.push(u):v.splice(z,1),O==null?void 0:O(v)}})),ue=c(u=>{x({type:6,trigger:u})}),a=c(u=>{x({type:8,element:u})}),H=c(u=>{x({type:9,element:u})}),_=c(u=>{x({type:10,element:u})}),V=K(()=>({onChange:A,registerOption:Q,goToOption:Y,setIsTyping:q,closeCombobox:ne,openCombobox:G,setActivationTrigger:ue,selectActiveOption:g,setInputElement:a,setButtonElement:H,setOptionsElement:_}),[]),[C,w]=vt(),X=n===null?{}:{ref:n},Ne=ce(()=>{if(h!==void 0)return O==null?void 0:O(h)},[O,h]);return D.createElement(w,{value:C,props:{htmlFor:(Oe=s.inputElement)==null?void 0:Oe.id},slot:{open:s.comboboxState===0,disabled:r}},D.createElement(it,null,D.createElement(ve.Provider,{value:V},D.createElement(ae.Provider,{value:s},D.createElement(bt,{value:te(s.comboboxState,{[0]:be.Open,[1]:be.Closed})},d!=null&&D.createElement(pt,{disabled:r,data:S!=null?{[d]:S}:{},form:m,onReset:Ne}),re({ourProps:X,theirProps:N,slot:k,defaultTag:Rt,name:"Combobox"}))))))}let ht="input";function Mt(t,n){var q,Y,Q,A,ue;let e=oe("Combobox.Input"),o=le("Combobox.Input"),f=se(),b=dt(),{id:m=b||`headlessui-combobox-input-${f}`,onChange:d,displayValue:T,disabled:r=e.disabled||!1,autoFocus:i=!1,type:l="text",...E}=t,R=Z(null),p=de(R,n,at(),o.setInputElement),F=Re(e.inputElement),N=je(),h=c(()=>{o.onChange(null),e.optionsElement&&(e.optionsElement.scrollTop=0),o.goToOption(P.Nothing)}),S=K(()=>{var a;return typeof T=="function"&&e.value!==void 0?(a=T(e.value))!=null?a:"":typeof e.value=="string"?e.value:""},[e.value,T]);he(([a,H],[_,V])=>{if(e.isTyping)return;let C=R.current;C&&((V===0&&H===1||a!==_)&&(C.value=a),requestAnimationFrame(()=>{if(e.isTyping||!C||(F==null?void 0:F.activeElement)!==C)return;let{selectionStart:w,selectionEnd:X}=C;Math.abs((X!=null?X:0)-(w!=null?w:0))===0&&w===0&&C.setSelectionRange(C.value.length,C.value.length)}))},[S,e.comboboxState,F,e.isTyping]),he(([a],[H])=>{if(a===0&&H===1){if(e.isTyping)return;let _=R.current;if(!_)return;let V=_.value,{selectionStart:C,selectionEnd:w,selectionDirection:X}=_;_.value="",_.value=V,X!==null?_.setSelectionRange(C,w,X):_.setSelectionRange(C,w)}},[e.comboboxState]);let O=Z(!1),I=c(()=>{O.current=!0}),x=c(()=>{N.nextFrame(()=>{O.current=!1})}),M=c(a=>{switch(o.setIsTyping(!0),a.key){case L.Enter:if(e.comboboxState!==0||O.current)return;if(a.preventDefault(),a.stopPropagation(),e.activeOptionIndex===null){o.closeCombobox();return}o.selectActiveOption(),e.mode===0&&o.closeCombobox();break;case L.ArrowDown:return a.preventDefault(),a.stopPropagation(),te(e.comboboxState,{[0]:()=>o.goToOption(P.Next),[1]:()=>o.openCombobox()});case L.ArrowUp:return a.preventDefault(),a.stopPropagation(),te(e.comboboxState,{[0]:()=>o.goToOption(P.Previous),[1]:()=>{ee(()=>o.openCombobox()),e.value||o.goToOption(P.Last)}});case L.Home:if(a.shiftKey)break;return a.preventDefault(),a.stopPropagation(),o.goToOption(P.First);case L.PageUp:return a.preventDefault(),a.stopPropagation(),o.goToOption(P.First);case L.End:if(a.shiftKey)break;return a.preventDefault(),a.stopPropagation(),o.goToOption(P.Last);case L.PageDown:return a.preventDefault(),a.stopPropagation(),o.goToOption(P.Last);case L.Escape:return e.comboboxState!==0?void 0:(a.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&a.stopPropagation(),e.mode===0&&e.value===null&&h(),o.closeCombobox());case L.Tab:if(e.comboboxState!==0)return;e.mode===0&&e.activationTrigger!==1&&o.selectActiveOption(),o.closeCombobox();break}}),y=c(a=>{d==null||d(a),e.mode===0&&a.target.value===""&&h(),o.openCombobox()}),B=c(a=>{var _,V,C;let H=(_=a.relatedTarget)!=null?_:De.find(w=>w!==a.currentTarget);if(!((V=e.optionsElement)!=null&&V.contains(H))&&!((C=e.buttonElement)!=null&&C.contains(H))&&e.comboboxState===0)return a.preventDefault(),e.mode===0&&e.value===null&&h(),o.closeCombobox()}),W=c(a=>{var _,V,C;let H=(_=a.relatedTarget)!=null?_:De.find(w=>w!==a.currentTarget);(V=e.buttonElement)!=null&&V.contains(H)||(C=e.optionsElement)!=null&&C.contains(H)||e.disabled||e.immediate&&e.comboboxState!==0&&N.microTask(()=>{ee(()=>o.openCombobox()),o.setActivationTrigger(1)})}),j=xe(),U=xt(),{isFocused:s,focusProps:$}=Ee({autoFocus:i}),{isHovered:k,hoverProps:g}=Se({isDisabled:r}),G=K(()=>({open:e.comboboxState===0,disabled:r,hover:k,focus:s,autofocus:i}),[e,k,s,i,r]),ne=Te({ref:p,id:m,role:"combobox",type:l,"aria-controls":(q=e.optionsElement)==null?void 0:q.id,"aria-expanded":e.comboboxState===0,"aria-activedescendant":e.activeOptionIndex===null?void 0:e.virtual?(Y=e.options.find(a=>!a.dataRef.current.disabled&&e.compare(a.dataRef.current.value,e.virtual.options[e.activeOptionIndex])))==null?void 0:Y.id:(Q=e.options[e.activeOptionIndex])==null?void 0:Q.id,"aria-labelledby":j,"aria-describedby":U,"aria-autocomplete":"list",defaultValue:(ue=(A=t.defaultValue)!=null?A:e.defaultValue!==void 0?T==null?void 0:T(e.defaultValue):null)!=null?ue:e.defaultValue,disabled:r||void 0,autoFocus:i,onCompositionStart:I,onCompositionEnd:x,onKeyDown:M,onChange:y,onFocus:W,onBlur:B},$,g);return re({ourProps:ne,theirProps:E,slot:G,defaultTag:ht,name:"Combobox.Input"})}let Dt="button";function Ft(t,n){var M;let e=oe("Combobox.Button"),o=le("Combobox.Button"),f=de(n,o.setButtonElement),b=se(),{id:m=`headlessui-combobox-button-${b}`,disabled:d=e.disabled||!1,autoFocus:T=!1,...r}=t,i=_e(e.inputElement),l=c(y=>{switch(y.key){case L.Space:case L.Enter:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&ee(()=>o.openCombobox()),i();return;case L.ArrowDown:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&(ee(()=>o.openCombobox()),e.value||o.goToOption(P.First)),i();return;case L.ArrowUp:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&(ee(()=>o.openCombobox()),e.value||o.goToOption(P.Last)),i();return;case L.Escape:if(e.comboboxState!==0)return;y.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&y.stopPropagation(),ee(()=>o.closeCombobox()),i();return;default:return}}),E=c(y=>{y.preventDefault(),!ct(y.currentTarget)&&(y.button===Be.Left&&(e.comboboxState===0?o.closeCombobox():o.openCombobox()),i())}),R=xe([m]),{isFocusVisible:p,focusProps:F}=Ee({autoFocus:T}),{isHovered:N,hoverProps:h}=Se({isDisabled:d}),{pressed:S,pressProps:O}=Ge({disabled:d}),I=K(()=>({open:e.comboboxState===0,active:S||e.comboboxState===0,disabled:d,value:e.value,hover:N,focus:p}),[e,N,p,S,d]),x=Te({ref:f,id:m,type:Ye(t,e.buttonElement),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(M=e.optionsElement)==null?void 0:M.id,"aria-expanded":e.comboboxState===0,"aria-labelledby":R,disabled:d||void 0,autoFocus:T,onMouseDown:E,onKeyDown:l},F,h,O);return re({ourProps:x,theirProps:r,slot:I,defaultTag:Dt,name:"Combobox.Button"})}let Vt="div",Lt=Le.RenderStrategy|Le.Static;function Bt(t,n){var q,Y,Q;let e=se(),{id:o=`headlessui-combobox-options-${e}`,hold:f=!1,anchor:b,portal:m=!1,modal:d=!0,transition:T=!1,...r}=t,i=oe("Combobox.Options"),l=le("Combobox.Options"),E=ut(b);E&&(m=!0);let[R,p]=rt(E),[F,N]=Pe(null),h=lt(),S=de(n,E?R:null,l.setOptionsElement,N),O=Re(i.optionsElement),I=mt(),[x,M]=tt(T,F,I!==null?(I&be.Open)===be.Open:i.comboboxState===0);Je(x,i.inputElement,l.closeCombobox);let y=i.__demoMode?!1:d&&i.comboboxState===0;Qe(y,O);let B=i.__demoMode?!1:d&&i.comboboxState===0;$e(B,{allowed:ce(()=>[i.inputElement,i.buttonElement,i.optionsElement],[i.inputElement,i.buttonElement,i.optionsElement])}),J(()=>{var A;i.optionsPropsRef.current.static=(A=t.static)!=null?A:!1},[i.optionsPropsRef,t.static]),J(()=>{i.optionsPropsRef.current.hold=f},[i.optionsPropsRef,f]),ot(i.comboboxState===0,{container:i.optionsElement,accept(A){return A.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:A.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(A){A.setAttribute("role","none")}});let W=xe([(q=i.buttonElement)==null?void 0:q.id]),j=K(()=>({open:i.comboboxState===0,option:void 0}),[i.comboboxState]),U=c(()=>{l.setActivationTrigger(0)}),s=c(A=>{A.preventDefault(),l.setActivationTrigger(0)}),$=Te(E?h():{},{"aria-labelledby":W,role:"listbox","aria-multiselectable":i.mode===1?!0:void 0,id:o,ref:S,style:{...r.style,...p,"--input-width":Ae(i.inputElement,!0).width,"--button-width":Ae(i.buttonElement,!0).width},onWheel:i.activationTrigger===0?void 0:U,onMouseDown:s,...et(M)}),k=x&&i.comboboxState===1,g=Me(k,(Y=i.virtual)==null?void 0:Y.options),G=Me(k,i.value),ne=c(A=>i.compare(G,A));if(i.virtual){if(g===void 0)throw new Error("Missing `options` in virtual mode");Object.assign(r,{children:D.createElement(ae.Provider,{value:g!==i.virtual.options?{...i,virtual:{...i.virtual,options:g}}:i},D.createElement(Pt,{slot:j},r.children))})}return D.createElement(yt,{enabled:m?t.static||x:!1},D.createElement(ae.Provider,{value:i.mode===1?i:{...i,isSelected:ne}},re({ourProps:$,theirProps:{...r,children:D.createElement(st,{freeze:k},typeof r.children=="function"?(Q=r.children)==null?void 0:Q.call(r,j):r.children)},slot:j,defaultTag:Vt,features:Lt,visible:x,name:"Combobox.Options"})))}let wt="div";function Nt(t,n){var U,s,$,k;let e=oe("Combobox.Option"),o=le("Combobox.Option"),f=se(),{id:b=`headlessui-combobox-option-${f}`,value:m,disabled:d=($=(s=(U=e.virtual)==null?void 0:U.disabled)==null?void 0:s.call(U,m))!=null?$:!1,order:T=null,...r}=t,i=_e(e.inputElement),l=e.virtual?e.activeOptionIndex===e.calculateIndex(m):e.activeOptionIndex===null?!1:((k=e.options[e.activeOptionIndex])==null?void 0:k.id)===b,E=e.isSelected(m),R=Z(null),p=Xe({disabled:d,value:m,domRef:R,order:T}),F=fe(we),N=de(n,R,F?F.measureElement:null),h=c(()=>{o.setIsTyping(!1),o.onChange(m)});J(()=>o.registerOption(b,p),[p,b]);let S=Z(!(e.virtual||e.__demoMode));J(()=>{if(!e.virtual&&!e.__demoMode)return Ve().requestAnimationFrame(()=>{S.current=!0})},[e.virtual,e.__demoMode]),J(()=>{if(S.current&&e.comboboxState===0&&l&&e.activationTrigger!==0)return Ve().requestAnimationFrame(()=>{var g,G;(G=(g=R.current)==null?void 0:g.scrollIntoView)==null||G.call(g,{block:"nearest"})})},[R,l,e.comboboxState,e.activationTrigger,e.activeOptionIndex]);let O=c(g=>{g.preventDefault(),g.button===Be.Left&&(d||(h(),Tt()||requestAnimationFrame(()=>i()),e.mode===0&&o.closeCombobox()))}),I=c(()=>{if(d)return o.goToOption(P.Nothing);let g=e.calculateIndex(m);o.goToOption(P.Specific,g)}),x=Ze(),M=c(g=>x.update(g)),y=c(g=>{if(!x.wasMoved(g)||d||l)return;let G=e.calculateIndex(m);o.goToOption(P.Specific,G,0)}),B=c(g=>{x.wasMoved(g)&&(d||l&&(e.optionsPropsRef.current.hold||o.goToOption(P.Nothing)))}),W=K(()=>({active:l,focus:l,selected:E,disabled:d}),[l,E,d]);return re({ourProps:{id:b,ref:N,role:"option",tabIndex:d===!0?void 0:-1,"aria-disabled":d===!0?!0:void 0,"aria-selected":E,disabled:void 0,onMouseDown:O,onFocus:I,onPointerEnter:M,onMouseEnter:M,onPointerMove:y,onMouseMove:y,onPointerLeave:B,onMouseLeave:B},theirProps:r,slot:W,defaultTag:wt,name:"Combobox.Option"})}let kt=ie(_t),Ht=ie(Ft),Ut=ie(Mt),Gt=gt,zt=ie(Bt),Kt=ie(Nt),ko=Object.assign(kt,{Input:Ut,Button:Ht,Label:Gt,Options:zt,Option:Kt});export{ko as Combobox,Ht as ComboboxButton,Ut as ComboboxInput,Gt as ComboboxLabel,Kt as ComboboxOption,zt as ComboboxOptions};
